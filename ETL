# ==============================================================
# FIN CORE - HELP SERVICE CONFIGURATION
# ==============================================================
spring.application.name=HelpService
server.port=9099

# --- ORACLE DATABASE ---
spring.datasource.url=jdbc:oracle:thin:@10.177.103.192:1523/fincorepdb1
spring.datasource.username=fincore
spring.datasource.password=Password#1234
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver

# --- JPA / HIBERNATE ---
spring.jpa.show-sql=false
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.open-in-view=false

# --- REDIS CACHE ---
spring.data.redis.host=10.0.17.242
spring.data.redis.port=6379
spring.cache.type=redis
# Cache time-to-live (1 Hour) - Refresh help content every hour
spring.cache.redis.time-to-live=3600000

# --- LOGGING ---
logging.level.com.fincore.HelpService=INFO

# --- Security ---
jwt.secret=bWV0aGlvbnlsdGhyZW9ueWx0aHJlb255bGdsdXRhbWlueWxhbGFueWw=


# DB Timeouts: Configuration of connection pooling timeouts in application.properties.
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.maximum-pool-size=30

# --- Actuator Base Config ---
# Enable the endpoints, but control exposure in specific profile files
management.endpoints.web.base-path=/actuator
management.endpoint.health.probes.enabled=true
management.endpoints.web.exposure.include=health, info, prometheus
management.endpoint.health.show-details=always
management.metrics.tags.application=${spring.application.name}
management.info.env.enabled=true


# ==============================================================
# RESILIENCE4J CONFIGURATION (Global Rules)
# ==============================================================
# --- 1. RETRY STRATEGY ---
# A. RETRY ON THESE (Transient / "Blips")
# 1. Spring's wrapper for DB Timeouts, Deadlocks, Connection Drops
resilience4j.retry.instances.defaultService.retry-exceptions[0]=org.springframework.dao.TransientDataAccessException
# 2. Connection failure at start of transaction
resilience4j.retry.instances.defaultService.retry-exceptions[1]=org.springframework.transaction.CannotCreateTransactionException
# 3. DB Resource Failure (DB Down)
resilience4j.retry.instances.defaultService.retry-exceptions[2]=org.springframework.dao.DataAccessResourceFailureException
# 4. Network I/O errors (for Feign/RestCalls)
resilience4j.retry.instances.defaultService.retry-exceptions[3]=java.io.IOException
resilience4j.retry.instances.defaultService.retry-exceptions[4]=java.net.ConnectException
resilience4j.retry.instances.defaultService.retry-exceptions[5]=java.net.SocketTimeoutException

# B. DO NOT RETRY ON THESE (Logic / Permanent Errors)
# Even if these happen, we fail immediately so GlobalExceptionHandler can return 400/409
resilience4j.retry.instances.defaultService.ignore-exceptions[0]=java.lang.IllegalArgumentException
resilience4j.retry.instances.defaultService.ignore-exceptions[1]=java.lang.NullPointerException
resilience4j.retry.instances.defaultService.ignore-exceptions[2]=org.springframework.dao.DataIntegrityViolationException
resilience4j.retry.instances.defaultService.ignore-exceptions[3]=org.springframework.dao.DuplicateKeyException
resilience4j.retry.instances.defaultService.ignore-exceptions[4]=org.springframework.web.client.HttpClientErrorException

# --- 2. CIRCUIT BREAKER STRATEGY ---
# If 50% of requests fail, OPEN the circuit (Fail Fast)
resilience4j.circuitbreaker.instances.defaultService.failure-rate-threshold=50
# Wait 10 seconds before trying again (Half-Open state)
resilience4j.circuitbreaker.instances.defaultService.wait-duration-in-open-state=10s
# Must have at least 5 calls to calculate failure rate
resilience4j.circuitbreaker.instances.defaultService.minimum-number-of-calls=5
# When Half-Open, allow 3 test calls to see if backend is up
resilience4j.circuitbreaker.instances.defaultService.permitted-number-of-calls-in-half-open-state=3
# Automatically move from Open to Half-Open
resilience4j.circuitbreaker.instances.defaultService.automatic-transition-from-open-to-half-open-enabled=true




# ==============================================================
#                           AI CONFIGS
# ==============================================================

# Ollama Configuration
spring.ai.ollama.base-url=http://localhost:11434
spring.ai.ollama.chat.model=phi3-mini
spring.ai.ollama.chat.options.temperature=0.1
spring.ai.ollama.embedding.model=mxbai-embed

# Redis Vector Store Configuration
spring.ai.vectorstore.redis.uri=redis://localhost:6380
spring.ai.vectorstore.redis.index=fincore-help-index
spring.ai.vectorstore.redis.prefix=fincore:doc:

# Web MVC Async Settings - 30 SEC LATER
spring.mvc.async.request-timeout=90000

