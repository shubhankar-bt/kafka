<!-- Fixes: jakarta.validation.NoProviderFoundException -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>

<!-- Required for Local LDAP Mock Server -->
<dependency>
    <groupId>com.unboundid</groupId>
    <artifactId>unboundid-ldapsdk</artifactId>
</dependency>













package com.fincore.gateway.Config;

import com.unboundid.ldap.listener.InMemoryDirectoryServer;
import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;
import com.unboundid.ldap.listener.InMemoryListenerConfig;
import jakarta.annotation.PostConstruct;
import jakarta.annotation.PreDestroy;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.ClassPathResource;

import java.io.File;

/**
 * Starts an embedded LDAP server for local testing ONLY.
 * Activated when the configured LDAP URL contains "localhost".
 */
@Slf4j
@Configuration
public class LocalLdapServer {

    @Value("${spring.ldap.urls:}")
    private String ldapUrl;

    private InMemoryDirectoryServer directoryServer;

    @PostConstruct
    public void startServer() {
        // Only start if we are pointing to localhost (Testing Mode)
        if (ldapUrl != null && ldapUrl.contains("localhost")) {
            try {
                log.info("STARTING LOCAL MOCK LDAP SERVER...");

                // CRITICAL FIX:
                // We initialize the server with the TOP-MOST Root ("dc=SBI").
                // This ensures it accepts "dc=SBI", "dc=UATAD,dc=SBI", etc.
                InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig("dc=SBI");
                
                config.addAdditionalBindCredentials("cn=admin", "admin");
                
                // Disable Schema Validation (Active Directory simulation)
                config.setSchema(null); 

                // Set Listener on port 8389
                config.setListenerConfigs(InMemoryListenerConfig.createLDAPConfig("default", 8389));

                directoryServer = new InMemoryDirectoryServer(config);
                
                // Load the data
                ClassPathResource ldifResource = new ClassPathResource("users.ldif");
                if (ldifResource.exists()) {
                    File ldifFile = ldifResource.getFile();
                    // Import from LDIF. 
                    directoryServer.importFromLDIF(true, ldifFile.getAbsolutePath());
                    log.info("Loaded Mock Data from users.ldif");
                } else {
                    log.warn("users.ldif not found! Server started empty.");
                }

                directoryServer.startListening();
                log.info("LOCAL MOCK LDAP SERVER STARTED on port 8389");
                log.info("Test Credentials -> User: 1015698 | Password: pass123");

            } catch (Exception e) {
                log.error("Failed to start Local LDAP Server", e);
            }
        }
    }

    @PreDestroy
    public void stopServer() {
        if (directoryServer != null) {
            directoryServer.shutDown(true);
            log.info("Local LDAP Server Stopped.");
        }
    }
}


















# 1. Define the Top Level Domain (SBI)
dn: dc=SBI
objectClass: top
objectClass: domain
dc: SBI

# 2. Define the Sub Domain (UATAD) - The Parent
dn: dc=UATAD,dc=SBI
objectClass: top
objectClass: domain
dc: UATAD

# 3. Define the User (The Child)
dn: cn=1015698,dc=UATAD,dc=SBI
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: user
cn: 1015698
sn: TestUser
sAMAccountName: 1015698
userPassword: pass123















