    /**
     * Fetches the live ETL Date dynamically so the AI never gives stale data.
     */
    public String getLiveEtlDate() {
        try {
            String sql = "SELECT TO_CHAR(ETL_DATE, 'DD-Mon-YYYY') FROM FINCORE_DATE FETCH FIRST 1 ROWS ONLY";
            return jdbcTemplate.queryForObject(sql, String.class);
        } catch (Exception e) {
            log.warn("Could not fetch ETL Date", e);
            return "System Date Unavailable";
        }
    }







            // Fetch the live ETL date in milliseconds!
            String liveEtlDate = permissionService.getLiveEtlDate();
            String currentTime = LocalDateTime.now().format(DateTimeFormatter.ofPattern("EEEE, MMMM dd, yyyy - hh:mm a"));
            
            String dynamicPrompt = """
                    You are the FinCore Smart Assistant, an advanced AI banking bot developed by Shubhankar.
                    
                    Current Time: %s
                    Current ETL Date: %s
                    User's Allowed Actions: %s
                    ...
                    """.formatted(currentTime, liveEtlDate, allowedActionNames);















-- This auto-generates procedural baseline knowledge for EVERY screen in your system instantly!
INSERT INTO HELP_QUESTION_MASTER (SCREEN_NAME, QUESTION_TEXT, ANSWER_CONTENT, PERMISSION_ID, ACTION_LINK, ACTION_LABEL, IS_ACTIVE)
SELECT 
    MENU_SUBMENU,
    'What is the purpose of the ' || MENU_SUBMENU || ' screen and what can I do there?',
    MENU_DESCRIPTION || '. On this screen, you have the ability to: ' || REPLACE(MENU_ACTION, '|', ', ') || '.',
    MENU_ID,
    MENU_URL,
    'Go to ' || MENU_SUBMENU,
    'Y'
FROM PERMISSIONS
WHERE MENU_URL IS NOT NULL AND MENU_DESCRIPTION IS NOT NULL;

















-- MAKER QUESTIONS (Only users with Role mapping to Permission 5 can search this)
INSERT INTO HELP_QUESTION_MASTER (SCREEN_NAME, QUESTION_TEXT, ANSWER_CONTENT, PERMISSION_ID, ACTION_LINK, ACTION_LABEL, PRO_TIP)
VALUES (
    'Manage CGLs', 
    'How do I create a new Central General Ledger (CGL)?', 
    'Navigate to the Manage CGLs screen. Click the Add New button, fill in the Segment mapping, and click Submit. Your request will enter a Pending state.', 
    5, -- CRITICAL: Maps to MENU_ID 5
    '/cgl-management', 
    'Go to Manage CGLs',
    'Ensure you verify the Segment Code before submitting.'
);

-- CHECKER QUESTIONS (Only users with Role mapping to Permission 6 can search this)
INSERT INTO HELP_QUESTION_MASTER (SCREEN_NAME, QUESTION_TEXT, ANSWER_CONTENT, PERMISSION_ID, ACTION_LINK, ACTION_LABEL, PRO_TIP)
VALUES (
    'CGL Requests', 
    'How do I approve or reject a pending CGL request?', 
    'Navigate to the CGL Requests screen. Locate the pending CGL in the grid, click to review the details, and select either Approve or Reject.', 
    6, -- CRITICAL: Maps to MENU_ID 6
    '/cgl-requests', 
    'Review CGL Requests',
    'You cannot approve a CGL that you created yourself.'
);

















INSERT INTO KNOWLEDGE_BASE_MASTER (TOPIC, CONTENT_PARAGRAPH, PERMISSION_ID, IS_ACTIVE)
VALUES (
    'CGL Maker-Checker Lifecycle', 
    'In the FinCore system, Central General Ledgers (CGLs) are governed by a strict Maker-Checker protocol. A user with "Manage CGLs" access (The Maker) can create or modify a CGL. However, the CGL does not become active immediately. It must be reviewed by a different user with "CGL Requests" access (The Checker). The Checker can either approve or reject the modification.', 
    NULL, -- CRITICAL: NULL means GLOBAL. Anyone can learn this concept.
    'Y'
);













