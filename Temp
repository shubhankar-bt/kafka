  // ... existing imports and state ...

  // 1. Create the Debounced API Fetch (Memoized)
  const fetchMwb = useMemo(
    () =>
      debounce(async (val) => {
        if (!val || val.length < 3) {
          setMwb([]);
          setMwbLoading(false);
          return;
        }
        
        setMwbLoading(true);
        try {
          // Verify this URL matches your backend requirement
          const url = "/CM/common-master/branches-code-name-only?q=" + encodeURIComponent(val);
          const res = await callApi(url, null, "GET");
          setMwb(res?.data || []);
        } catch (e) {
          console.error(e);
          setMwb([]); // Clear on error to be safe
        } finally {
          setMwbLoading(false);
        }
      }, 400),
    [callApi]
  );

  // 2. Create the Handler for Input Change (Instant UI Update)
  const handleMwbInputChange = useCallback((event, newInputValue) => {
      // Update state IMMEDIATELY so user sees what they type
      setMwbInputValue(newInputValue);
      
      // Trigger the debounced API call
      fetchMwb(newInputValue);
  }, [fetchMwb]);

  // ... rest of the file ...

















          {/* ... Close Date and Merge Date components ... */}

          <CustomAutoComplete
            key={isClosed ? "mwb-closed" : "mwb-open"}
            label="Merge with Branch"
            name="mergedWithBranch"
            
            // 1. Data & Loading
            options={mwb || []}
            loading={mwbLoading}
            
            // 2. Selection Logic (The Object)
            value={isClosed ? null : branchData.mergedWithBranch}
            onChange={(val) => handleAutoCompleteChange("mergedWithBranch", val)}
            
            // 3. Typing Logic (The String)
            inputValue={mwbInputValue}
            onInputChange={handleMwbInputChange}
            
            // 4. Config
            disabled={isClosed}
            renderOption={(option) => `${option.code} (${option.name})`}
            uniqueElementKey="code"
            error={errors?.mergedWithBranch}
          />


