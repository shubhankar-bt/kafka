package com.fincore.commonutilities.util;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ObjectNode;

public class MaskingUtil {

    private static final ObjectMapper mapper = new ObjectMapper();

    /**
     * Masks PII fields inside a JSON String.
     */
    public static String maskJsonString(String jsonInput) {
        if (jsonInput == null || jsonInput.isEmpty()) return "{}";
        try {
            JsonNode root = mapper.readTree(jsonInput);
            maskSensitiveFields(root);
            return root.toString();
        } catch (JsonProcessingException e) {
            return "Error parsing JSON payload"; 
        }
    }

    private static void maskSensitiveFields(JsonNode node) {
        if (node.isObject()) {
            ObjectNode objectNode = (ObjectNode) node;
            objectNode.fieldNames().forEachRemaining(fieldName -> {
                JsonNode value = objectNode.get(fieldName);
                if (isSensitive(fieldName)) {
                    objectNode.put(fieldName, "****");
                } else {
                    maskSensitiveFields(value); // Recurse
                }
            });
        } else if (node.isArray()) {
            node.forEach(MaskingUtil::maskSensitiveFields);
        }
    }

    private static boolean isSensitive(String fieldName) {
        String lower = fieldName.toLowerCase();
        return lower.contains("email") || 
               lower.contains("mobile") || 
               lower.contains("phone") || 
               lower.contains("password") || 
               lower.contains("pan") || 
               lower.contains("account");
    }
}

































package com.tcs.userservice.dto;

import com.fincore.commonutilities.util.MaskingUtil;
import lombok.Data; 
// ... imports

@Data
public class UserRequestCreateDto {

    private String requestType;
    private String targetUserId;
    private String requestPayload; // This contains the JSON string

    // ... other fields ...

    @Override
    public String toString() {
        return "UserRequestCreateDto(" +
                "requestType=" + requestType +
                ", targetUserId=" + targetUserId +
                ", requestPayload=" + MaskingUtil.maskJsonString(requestPayload) + 
                ")";
    }
}

